# Core Service Logic

The business logic is encapsulated within **Service Classes**. These services isolate the database operations from the HTTP transport layer.

## 1. User Identity (`UserService`)
Manages the lifecycle of student accounts and authentication.

* **Constraint Enforcement:** Enforces uniqueness for Email and Username at the application level before hitting database constraints.
* **Cryptography:** Handles password hashing using `passlib`. Passwords are never stored or returned in plain text.
* **Authentication Flow:**
    1.  Accepts raw credentials (username/email + password).
    2.  Verifies password hash.
    3.  Returns a validated User entity.

## 2. Academic Management (`SubjectService`)
Manages the "Input Data" required by the AI Agents.

* **Temporal Validation:** Enforces logic ensuring `start_date` < `end_date`.
* **Ownership Enforcement:** Strictly verifies that the subject ID requested belongs to the `student_id` performing the request.
* **Heuristic Mapping:** Manages specific metadata (Difficulty 1-5, Type: Written/Project) that acts as prompt inputs for the AI agents.

## 3. Schedule Management (`PlanService`)
The central hub connecting Users to AI Generations.

* **Generation Tracking:** Implements `generation_id` (UUID) logic. This allows the system to group multiple distinct `Plan` entries (days) into a single "Generation Event."
* **Conflict Resolution:** Checks if a plan already exists for a specific date to prevent duplicate schedule entries for the same day.
* **History Retrieval:** Provides methods to fetch the "Latest Schedule" by finding the most recent `generation_id` timestamp.

## 4. Granular Task Logic (`AITaskService`)
Manages the atomic units of work generated by the AI.

* **Referential Integrity:** Validates that every AI Task is linked to an existing `Plan` AND an existing `Subject`.
* **Data Quality:** Enforces valid ranges for Priority (1-10) and Difficulty (1-5) to ensure the `FeedbackAgent` receives standardized data for rescheduling.